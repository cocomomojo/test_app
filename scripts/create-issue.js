#!/usr/bin/env node

const { exec } = require('child_process');
const util = require('util');
const execPromise = util.promisify(exec);

// Issue ã‚¿ã‚¤ãƒ—ã®å®šç¾©
const ISSUE_TYPES = {
  'e2e-test': {
    title: 'E2E ãƒ†ã‚¹ãƒˆä½œæˆ',
    labels: ['test', 'e2e', 'auto-generated'],
    assignee: 'e2e-test-specialist',
    bodyTemplate: (date) => `## èƒŒæ™¯
è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸE2Eãƒ†ã‚¹ãƒˆä½œæˆã‚¿ã‚¹ã‚¯ã§ã™ã€‚

## å¯¾è±¡æ©Ÿèƒ½ã¨ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ª
### ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½
- [ ] æ­£å¸¸ç³»: æ­£ã—ã„èªè¨¼æƒ…å ±ã§ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
- [ ] ç•°å¸¸ç³»: ç©ºã®ãƒ¦ãƒ¼ã‚¶åã§ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
- [ ] ç•°å¸¸ç³»: ä¸æ­£ãªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚¨ãƒ©ãƒ¼è¡¨ç¤º

### TODOç®¡ç†æ©Ÿèƒ½
- [ ] ä½œæˆ: æ–°è¦TODOä½œæˆ
- [ ] å‰Šé™¤: TODOå‰Šé™¤
- [ ] å®Œäº†: TODOå®Œäº†ãƒãƒ¼ã‚¯

### ãƒ¡ãƒ¢ç®¡ç†æ©Ÿèƒ½
- [ ] ä½œæˆ: æ–°è¦ãƒ¡ãƒ¢ä½œæˆ
- [ ] ç·¨é›†: ãƒ¡ãƒ¢ç·¨é›†
- [ ] å‰Šé™¤: ãƒ¡ãƒ¢å‰Šé™¤

## å—ã‘å…¥ã‚Œæ¡ä»¶
- ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒãƒ­ãƒ¼ã‚«ãƒ«ã§æˆåŠŸã™ã‚‹ã“ã¨
- Allureãƒ¬ãƒãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚Œã‚‹ã“ã¨
- ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ãŒ80%ä»¥ä¸Šã§ã‚ã‚‹ã“ã¨

## å®Ÿè£…ãƒ‘ã‚¹
\`frontend/tests/e2e/\`

---
**è‡ªå‹•ç”Ÿæˆæ—¥**: ${date}
**è‡ªå‹•ç”Ÿæˆã‚¿ã‚¤ãƒ—**: E2Eãƒ†ã‚¹ãƒˆä½œæˆ`
  },
  'manual': {
    title: 'æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ä½œæˆ',
    labels: ['documentation', 'manual', 'auto-generated'],
    assignee: 'manual-specialist',
    bodyTemplate: (date) => `## èƒŒæ™¯
è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸæ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ä½œæˆã‚¿ã‚¹ã‚¯ã§ã™ã€‚

## å¯¾è±¡æ©Ÿèƒ½
### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ‰‹é †
- [ ] TODOç®¡ç†æ©Ÿèƒ½ã®ä½¿ã„æ–¹
- [ ] ãƒ¡ãƒ¢ç®¡ç†æ©Ÿèƒ½ã®ä½¿ã„æ–¹
- [ ] è¨­å®šå¤‰æ›´æ‰‹é †

### ç®¡ç†è€…å‘ã‘æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«
- [ ] ã‚·ã‚¹ãƒ†ãƒ è¨­å®šæ‰‹é †
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ‰‹é †
- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢æ‰‹é †

## æˆæœç‰©
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ãƒãƒ‹ãƒ¥ã‚¢ãƒ« (Markdownå½¢å¼)
- ç®¡ç†è€…å‘ã‘ãƒãƒ‹ãƒ¥ã‚¢ãƒ« (Markdownå½¢å¼)
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆä»˜ãæ‰‹é †æ›¸

## å—ã‘å…¥ã‚Œæ¡ä»¶
- åˆå¿ƒè€…ã§ã‚‚ç†è§£ã§ãã‚‹æ˜ç¢ºãªèª¬æ˜
- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’é©åˆ‡ã«é…ç½®
- ç›®æ¬¡ã¨ãƒªãƒ³ã‚¯ãŒæ­£ã—ãæ©Ÿèƒ½ã™ã‚‹ã“ã¨

## å®Ÿè£…ãƒ‘ã‚¹
\`wiki/manual/\`

---
**è‡ªå‹•ç”Ÿæˆæ—¥**: ${date}
**è‡ªå‹•ç”Ÿæˆã‚¿ã‚¤ãƒ—**: æ“ä½œãƒãƒ‹ãƒ¥ã‚¢ãƒ«ä½œæˆ`
  },
  'feature': {
    title: 'ã‚¢ãƒ—ãƒªæ©Ÿèƒ½æ”¹ä¿®',
    labels: ['enhancement', 'feature', 'auto-generated'],
    assignee: null,
    bodyTemplate: (date) => `## èƒŒæ™¯
è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚¢ãƒ—ãƒªæ©Ÿèƒ½æ”¹ä¿®ã‚¿ã‚¹ã‚¯ã§ã™ã€‚

## æ”¹ä¿®å¯¾è±¡æ©Ÿèƒ½
### UI/UXæ”¹å–„
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³å¯¾å¿œ
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ”¹å–„

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„
- [ ] ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿é€Ÿåº¦ã®æœ€é©åŒ–
- [ ] API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ã®çŸ­ç¸®
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã®å‰Šæ¸›

### æ–°æ©Ÿèƒ½è¿½åŠ 
- [ ] æ¤œç´¢æ©Ÿèƒ½ã®å¼·åŒ–
- [ ] ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ©Ÿèƒ½ã®è¿½åŠ 
- [ ] ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½ã®å®Ÿè£…

## å—ã‘å…¥ã‚Œæ¡ä»¶
- æ—¢å­˜æ©Ÿèƒ½ã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã“ã¨
- ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹ã“ã¨
- ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å®Œäº†ã™ã‚‹ã“ã¨
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨

## å®Ÿè£…ãƒ‘ã‚¹
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: \`frontend/src/\`
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: \`backend/src/\`

---
**è‡ªå‹•ç”Ÿæˆæ—¥**: ${date}
**è‡ªå‹•ç”Ÿæˆã‚¿ã‚¤ãƒ—**: ã‚¢ãƒ—ãƒªæ©Ÿèƒ½æ”¹ä¿®`
  },
  'error-analysis': {
    title: 'ã‚¨ãƒ©ãƒ¼è§£æ',
    labels: ['bug', 'error-analysis', 'auto-generated'],
    assignee: null,
    bodyTemplate: (date) => `## èƒŒæ™¯
è‡ªå‹•ç”Ÿæˆã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼è§£æã‚¿ã‚¹ã‚¯ã§ã™ã€‚

## ã‚¨ãƒ©ãƒ¼è§£æå¯¾è±¡
### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼
- [ ] ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚¨ãƒ©ãƒ¼ã®åˆ†æ
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã®èª¿æŸ»
- [ ] ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚¨ãƒ©ãƒ¼ã®ç‰¹å®š

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚¨ãƒ©ãƒ¼
- [ ] ã‚µãƒ¼ãƒãƒ¼ãƒ­ã‚°ã®åˆ†æ
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã®èª¿æŸ»
- [ ] API ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®æ”¹å–„

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å•é¡Œ
- [ ] ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ã®èª¿æŸ»
- [ ] é…å»¶å‡¦ç†ã®ç‰¹å®š
- [ ] ãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã®åˆ†æ

## è§£ææ‰‹æ³•
- ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª
- ã‚¨ãƒ©ãƒ¼ãƒˆãƒ¬ãƒ¼ã‚¹ã®è¿½è·¡
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒªãƒ³ã‚°
- ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã§ã®å†ç¾

## æˆæœç‰©
- ã‚¨ãƒ©ãƒ¼åˆ†æãƒ¬ãƒãƒ¼ãƒˆ
- åŸå› ç‰¹å®šã¨å¯¾ç­–æ¡ˆ
- ä¿®æ­£ãƒ‘ãƒƒãƒã¾ãŸã¯PR

## å—ã‘å…¥ã‚Œæ¡ä»¶
- ã‚¨ãƒ©ãƒ¼ã®æ ¹æœ¬åŸå› ã‚’ç‰¹å®šã™ã‚‹ã“ã¨
- å†ç¾æ‰‹é †ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨
- ä¿®æ­£æ¡ˆã‚’æç¤ºã™ã‚‹ã“ã¨

## å®Ÿè£…ãƒ‘ã‚¹
- ãƒ­ã‚°: \`logs/\`
- ä¿®æ­£: è©²å½“ãƒ•ã‚¡ã‚¤ãƒ«

---
**è‡ªå‹•ç”Ÿæˆæ—¥**: ${date}
**è‡ªå‹•ç”Ÿæˆã‚¿ã‚¤ãƒ—**: ã‚¨ãƒ©ãƒ¼è§£æ`
  }
};

/**
 * GitHub Issue ã‚’ä½œæˆ
 * @param {string} type - Issue ã‚¿ã‚¤ãƒ— ('e2e-test', 'manual', 'feature', 'error-analysis')
 */
async function createIssue(type) {
  const config = ISSUE_TYPES[type];
  
  if (!config) {
    console.error(`âŒ ä¸æ˜ãªIssueã‚¿ã‚¤ãƒ—ã§ã™: ${type}`);
    console.error(`åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚¤ãƒ—: ${Object.keys(ISSUE_TYPES).join(', ')}`);
    process.exit(1);
  }

  try {
    const date = new Date().toLocaleDateString('ja-JP', {
      year: 'numeric',
      month: '2-digit',
      day: '2-digit'
    });
    
    const title = `[è‡ªå‹•] ${config.title} - ${date}`;
    const body = config.bodyTemplate(date);
    const labels = config.labels.join(',');

    let command = `gh issue create \
      --title "${title}" \
      --body "${body}" \
      --label "${labels}"`;

    if (config.assignee) {
      command += ` --assignee "${config.assignee}"`;
    }

    console.log(`ğŸ“ ${config.title}ã®Issue ã‚’ä½œæˆä¸­...`);
    const { stdout } = await execPromise(command);
    
    console.log(`âœ… Issue ã‚’ä½œæˆã—ã¾ã—ãŸ:`);
    console.log(stdout);

  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error.message);
    process.exit(1);
  }
}

// ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å¼•æ•°ã‹ã‚‰Issueã‚¿ã‚¤ãƒ—ã‚’å–å¾—
const args = process.argv.slice(2);
const type = args[0];

if (!type) {
  console.log('ä½¿ç”¨æ–¹æ³•: node scripts/create-issue.js <type>');
  console.log('');
  console.log('åˆ©ç”¨å¯èƒ½ãªã‚¿ã‚¤ãƒ—:');
  Object.keys(ISSUE_TYPES).forEach(key => {
    console.log(`  - ${key}: ${ISSUE_TYPES[key].title}`);
  });
  process.exit(1);
}

createIssue(type);
