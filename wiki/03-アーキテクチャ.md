# ğŸ—ï¸ 3. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€Test App ã®ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆã¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ“ å…¨ä½“ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```mermaid
graph TB
    subgraph "ğŸ–¥ï¸ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ"
        direction TB
        FE["ğŸ–– Frontend<br/>Vue.js + Vite<br/>Port: 5173"]
        BE["ğŸƒ Backend<br/>Spring Boot<br/>Port: 8080"]
        DB["ğŸ—„ï¸ MySQL<br/>Port: 3306"]
        S3["â˜ï¸ LocalStack S3<br/>Port: 9000"]
        H2["ğŸ’¾ H2 Database<br/>In-Memory"]
    end
    
    subgraph "ğŸŒ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ–ãƒ©ã‚¦ã‚¶"
        Browser["ğŸŒ Web Browser<br/>HTTP/HTTPS"]
    end
    
    subgraph "âš™ï¸ CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³"
        GHActions["ğŸ”„ GitHub Actions"]
        PW["ğŸ­ Playwright<br/>E2E Tests"]
        Allure["ğŸ“Š Allure<br/>Report Generator"]
    end
    
    subgraph "ğŸ“¤ æˆæœç‰©"
        GHP["ğŸ“„ GitHub Pages<br/>Test Report"]
    end
    
    Browser -->|HTTP Request| FE
    FE -->|REST API| BE
    BE -->|SQL Query| DB
    BE -->|Put/Get Object| S3
    BE -->|Response JSON| FE
    FE -->|Render HTML| Browser
    
    GHActions -->|Trigger| BE
    GHActions -->|Trigger| FE
    PW -->|Access| FE
    PW -->|Call| BE
    Allure -->|Generate| GHP
    
    style FE fill:#61dafb,stroke:#333,stroke-width:2px,color:#000
    style BE fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
    style DB fill:#4479a1,stroke:#333,stroke-width:2px,color:#fff
    style S3 fill:#ff9800,stroke:#333,stroke-width:2px,color:#000
    style Browser fill:#f0f0f0,stroke:#333,stroke-width:2px,color:#000
    style GHP fill:#ff6b6b,stroke:#333,stroke-width:2px,color:#fff
```

---

## ğŸ”¢ ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

Test App ã¯ **3 å±¤ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ‰ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹æˆ

```mermaid
graph TB
    subgraph "Presentation Layer"
        UI["ğŸ¨ UI Components<br/>Vue.js Single Page App"]
        Router["ğŸ—ºï¸ Vue Router<br/>Route Navigation"]
    end
    
    subgraph "Business Logic Layer"
        Controller["ğŸ® @RestController<br/>Request Mapping"]
        Service["âš™ï¸ @Service<br/>Business Logic"]
    end
    
    subgraph "Data Access Layer"
        Repository["ğŸ’¾ @Repository<br/>JPA Repository"]
        Entity["ğŸ“¦ @Entity<br/>JPA Entity"]
    end
    
    subgraph "External Resources"
        DB["ğŸ—„ï¸ MySQL Database<br/>Primary DB"]
        S3["â˜ï¸ AWS S3 / LocalStack<br/>Object Storage"]
        Cache["ğŸ“¦ Cache<br/>Session/Memory"]
    end
    
    UI -->|Event Handling| Router
    Router -->|API Request| Controller
    Controller -->|Call| Service
    Service -->|Query/Update| Repository
    Repository -->|Map to| Entity
    Entity -->|Persist| DB
    Service -->|Upload/Download| S3
    Controller -->|Session| Cache
    
    style UI fill:#61dafb,stroke:#333,stroke-width:2px,color:#000
    style Controller fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
    style Service fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
    style Repository fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
    style DB fill:#4479a1,stroke:#333,stroke-width:2px,color:#fff
    style S3 fill:#ff9800,stroke:#333,stroke-width:2px,color:#000
```

### å„ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å½¹å‰²

| ãƒ¬ã‚¤ãƒ¤ãƒ¼ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | è²¬å‹™ |
|---------|----------------|------|
| **Presentation Layer** | Vue Components | UI è¡¨ç¤ºã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç† |
| **Presentation Layer** | Vue Router | ãƒšãƒ¼ã‚¸é·ç§»ã€ãƒ«ãƒ¼ãƒˆç®¡ç† |
| **Controller Layer** | @RestController | HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ã‘å–ã‚Šã€JSON ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¿”å´ |
| **Service Layer** | @Service | ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ç®¡ç† |
| **Repository Layer** | JPA Repository | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹ã€ORM ãƒãƒƒãƒ”ãƒ³ã‚° |
| **Entity Layer** | @Entity | ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå®šç¾©ã€ãƒ†ãƒ¼ãƒ–ãƒ«æ§‹é€ å®šç¾© |
| **Persistence** | MySQL | ãƒ‡ãƒ¼ã‚¿ã®æ°¸ç¶šåŒ– |
| **Storage** | S3/LocalStack | ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç®¡ç† |

---

## ğŸ”„ é€šä¿¡ãƒ•ãƒ­ãƒ¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant Browser as ğŸŒ Browser
    participant FE as ğŸ–– Frontend
    participant BE as ğŸƒ Backend
    participant DB as ğŸ—„ï¸ Database
    
    Browser->>FE: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ã‚¢ã‚¯ã‚»ã‚¹
    FE->>FE: ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ è¡¨ç¤º
    Browser->>FE: ãƒ¦ãƒ¼ã‚¶ãƒ¼åãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
    FE->>BE: POST /api/auth/login
    BE->>BE: å…¥åŠ›å€¤æ¤œè¨¼
    BE->>DB: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
    DB-->>BE: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
    BE->>BE: ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
    BE->>BE: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”Ÿæˆ
    BE-->>FE: JWT Token + User Info
    FE->>FE: Token ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    FE->>Browser: Dashboard ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
    Browser->>FE: Dashboard è¡¨ç¤º
```

### ToDo ä½œæˆãƒ•ãƒ­ãƒ¼

```mermaid
sequenceDiagram
    participant FE as ğŸ–– Frontend
    participant BE as ğŸƒ Backend
    participant Service as âš™ï¸ Service
    participant Repo as ğŸ’¾ Repository
    participant DB as ğŸ—„ï¸ Database
    
    FE->>FE: "æ–°è¦ ToDo" ã‚’ã‚¯ãƒªãƒƒã‚¯
    FE->>FE: ãƒ€ã‚¤ã‚¢ãƒ­ã‚°è¡¨ç¤ºã€ãƒ•ã‚©ãƒ¼ãƒ å…¥åŠ›
    FE->>BE: POST /api/todos
    BE->>Service: todoService.create(dto)
    Service->>Service: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯æ¤œè¨¼
    Service->>Repo: save(entity)
    Repo->>DB: INSERT INTO todos
    DB-->>Repo: æˆåŠŸ
    Repo-->>Service: ä¿å­˜æ¸ˆã¿ Entity
    Service-->>BE: ä½œæˆçµæœ
    BE-->>FE: 201 Created + JSON
    FE->>FE: ãƒªã‚¹ãƒˆæ›´æ–°
    FE->>Browser: UI å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
```

---

## ğŸ“Š ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é–¢ä¿‚æ€§

### Backend ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå›³

```mermaid
graph LR
    subgraph "HTTP Layer"
        Controller["ğŸ® TodoController<br/>REST Endpoints"]
    end
    
    subgraph "Business Logic Layer"
        TodoService["âš™ï¸ TodoService<br/>Main Logic"]
        UserService["âš™ï¸ UserService<br/>Auth Logic"]
        FileService["âš™ï¸ FileService<br/>S3 Logic"]
    end
    
    subgraph "Data Access Layer"
        TodoRepo["ğŸ’¾ TodoRepository<br/>SQL Query"]
        UserRepo["ğŸ’¾ UserRepository<br/>SQL Query"]
    end
    
    subgraph "External Service"
        S3["â˜ï¸ AWS S3 SDK<br/>Object Storage"]
        MySQL["ğŸ—„ï¸ MySQL<br/>Primary DB"]
    end
    
    Controller -->|Call| TodoService
    Controller -->|Call| UserService
    TodoService -->|Call| TodoRepo
    TodoService -->|Call| FileService
    TodoRepo -->|Query| MySQL
    UserService -->|Call| UserRepo
    UserRepo -->|Query| MySQL
    FileService -->|Upload/Download| S3
    
    style Controller fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
    style TodoService fill:#f5a623,stroke:#333,stroke-width:2px,color:#000
    style UserService fill:#f5a623,stroke:#333,stroke-width:2px,color:#000
    style FileService fill:#f5a623,stroke:#333,stroke-width:2px,color:#000
    style TodoRepo fill:#4479a1,stroke:#333,stroke-width:2px,color:#fff
    style UserRepo fill:#4479a1,stroke:#333,stroke-width:2px,color:#fff
    style S3 fill:#ff9800,stroke:#333,stroke-width:2px,color:#000
    style MySQL fill:#4479a1,stroke:#333,stroke-width:2px,color:#fff
```

### Frontend ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå›³

```mermaid
graph TB
    subgraph "Router Layer"
        Router["ğŸ—ºï¸ Vue Router<br/>Route Definition"]
    end
    
    subgraph "Page Components"
        Home["ğŸ“„ Home<br/>Dashboard"]
        Todo["âœ“ Todo<br/>Todo List"]
        Memo["ğŸ“ Memo<br/>Memo Manager"]
        Auth["ğŸ” Auth<br/>Login/Logout"]
    end
    
    subgraph "Reusable Components"
        Header["ğŸ¨ Header<br/>Navigation"]
        Footer["ğŸ¨ Footer<br/>Info"]
        Modal["ğŸ¨ Modal<br/>Dialog"]
    end
    
    subgraph "API Layer"
        TodoAPI["ğŸ“¡ TodoAPI<br/>API Client"]
        AuthAPI["ğŸ“¡ AuthAPI<br/>API Client"]
    end
    
    subgraph "State Management"
        Store["ğŸ”„ Store<br/>Vuex/Composition"]
    end
    
    Router -->|Route To| Home
    Router -->|Route To| Todo
    Router -->|Route To| Memo
    Router -->|Route To| Auth
    
    Home -->|Uses| Header
    Todo -->|Uses| Header
    Memo -->|Uses| Header
    Todo -->|Uses| Modal
    
    Todo -->|API Call| TodoAPI
    Auth -->|API Call| AuthAPI
    
    TodoAPI -->|Access| Store
    AuthAPI -->|Access| Store
    
    style Router fill:#61dafb,stroke:#333,stroke-width:2px,color:#000
    style TodoAPI fill:#42a5f5,stroke:#333,stroke-width:2px,color:#fff
    style AuthAPI fill:#42a5f5,stroke:#333,stroke-width:2px,color:#fff
    style Store fill:#ab47bc,stroke:#333,stroke-width:2px,color:#fff
```

---

## ğŸ” ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
graph LR
    Browser["ğŸŒ Browser"]
    FE["ğŸ–– Frontend"]
    Security["ğŸ” Spring Security"]
    Controller["ğŸ® Controller"]
    
    Browser -->|Request + Token| FE
    FE -->|Authorization Header| Security
    Security -->|Validate| Security
    Security -->|Allow| Controller
    Security -->|Deny| Security
    Security -->|401 Error| FE
    
    style Security fill:#d32f2f,stroke:#333,stroke-width:2px,color:#fff
    style Controller fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
```

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–ï¼š**
- JWT ãƒˆãƒ¼ã‚¯ãƒ³ãƒ™ãƒ¼ã‚¹ã®èªè¨¼
- Spring Security ã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¤œè¨¼
- CORS è¨­å®šã«ã‚ˆã‚‹ API ã‚¢ã‚¯ã‚»ã‚¹åˆ¶é™
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–ï¼ˆBCryptï¼‰

---

## ğŸ“ˆ ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ã®è€ƒæ…®

### ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥

```mermaid
graph LR
    Request["ğŸ“¥ Request"]
    Cache["ğŸ“¦ Cache<br/>Memory/Redis"]
    Service["âš™ï¸ Service"]
    DB["ğŸ—„ï¸ Database"]
    
    Request -->|Check| Cache
    Cache -->|Hit| Request
    Cache -->|Miss| Service
    Service -->|Query| DB
    DB -->|Result| Service
    Service -->|Store| Cache
    Service -->|Response| Request
    
    style Cache fill:#ff9800,stroke:#333,stroke-width:2px,color:#000
    style Service fill:#f5a623,stroke:#333,stroke-width:2px,color:#000
    style DB fill:#4479a1,stroke:#333,stroke-width:2px,color:#fff
```

### è² è·åˆ†æ•£ã®è€ƒæ…®

```mermaid
graph TB
    LB["âš–ï¸ Load Balancer"]
    BE1["ğŸƒ Backend Instance 1"]
    BE2["ğŸƒ Backend Instance 2"]
    DB[(ğŸ—„ï¸ Shared Database)]
    
    LB -->|Route| BE1
    LB -->|Route| BE2
    BE1 -->|Query| DB
    BE2 -->|Query| DB
    
    style LB fill:#ff6b6b,stroke:#333,stroke-width:2px,color:#fff
    style BE1 fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
    style BE2 fill:#6db33f,stroke:#333,stroke-width:2px,color:#fff
```

---

## ğŸ“š æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

- [ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ ](./04-ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ .md) - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆè©³ç´°
- [ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«](./05-ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«.md) - ERå›³ã¨ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£è¨­è¨ˆ
- [ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ](./06-ã‚³ã‚¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ.md) - å®Ÿè£…è©³ç´°
