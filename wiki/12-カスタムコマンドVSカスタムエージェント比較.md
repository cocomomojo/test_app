# GitHub Copilot カスタムコマンド vs カスタムエージェント vs Agent Skills 比較

## 概要

GitHub Copilotの3つの高度な機能「カスタムコマンド」「カスタムエージェント」「Agent Skills」の違いを整理します。

| 項目 | カスタムコマンド | カスタムエージェント | Agent Skills |
|------|-----------------|-------------------|-------------|
| **機能の位置付け** | チャットコマンド拡張 | リポジトリ固有の専門エージェント | 外部ツール・API統合スキル |
| **設定ファイル形式** | `.github/prompts/*.prompt.md` | `.github/agents/*.agent.md` | `.github/skills/*.yml` / MCP |
| **実行環境** | VS Code / GitHub Copilot Chat | VS Code / GitHub.com コーディングエージェント | VS Code / GitHub.com / API |
| **活用シーン** | 繰り返し実行するタスク自動化 | Issue に自動アサイン・並列実装 | 高度な外部連携、専門ツール統合 |
| **スキル種類** | なし | なし | ファイル操作、Web検索、データ分析など |

---

## 1. カスタムコマンド (Custom Commands)

### 概要
GitHub Copilotに対して、プロジェクト固有のルールや指示を事前に定義しておける機能。
毎回同じ指示を書く必要がなく、チーム全体で同じフォーマットを共有できます。

### 特徴

#### メリット
- **操作が簡単** 
  - `/コマンド名` で実行するだけ
  - 毎回長い指示を書く必要がない
  
- **フォーマット統一**
  - チーム全体で同じフォーマット、基準を維持
  
- **拡張性が高い**
  - コードレビュー、ドキュメント生成、テストケース生成など自由にカスタマイズ可能
  
- **学習コストが低い**
  - プロンプト形式なので、誰でも簡単に追加・カスタマイズできる
  
- **導入が迅速**
  - インフラ構築不要、すぐに効果を実感

#### デメリット
- **受動的な実行**
  - ユーザーが毎回手動で `/コマンド` を実行する必要がある
  - 自動化には限界がある
  
- **複雑な自動フロー構築には不向き**
  - 単純な "指示→実行" モデル
  - 複数ステップの自動化には制限あり
  
- **外部システム連携が困難**
  - コード生成が主な機能
  - API呼び出しなどは限定的

### 設定方法

```markdown
---
agent: 'agent'
model: Claude Sonnet 4.5
tools: [read, edit, search, todo]
description: 'ToDoアイテムを作成'
---

# ゴール
指示された内容に基づき、具体的なToDoアイテムを作成する。
- バグ/設計/セキュリティ/テスト/可読性を網羅
- 重大度を ❌Critical / ⚠️Major / 💡Minor で分類
```

### 活用例
- **ToDo管理の自動化**
  - コード課題を特定し、タイムスタンプ付きMarkdownで出力
  
- **Conventional Commits**
  - コミットメッセージを規約に自動生成
  
- **コードレビュー**
  - プロジェクト基準に沿った自動レビュー
  
- **テスト計画生成**
  - テスト戦略とQA計画を自動生成

---

## 2. カスタムエージェント (Custom Agents)

### 概要
バックエンド、フロントエンド、SREなど、専門性を持ったエージェントチームを構築できる機能。
`.github/agents/` ディレクトリに agents.md ファイルを配置することで定義。

### 特徴

#### メリット
- **Issue に自動アサイン可能**
  - カスタムエージェントを Issue に割り当て、自動実装を開始
  - 複数の Issue に異なるエージェントをアサインして並列実装可能
  
- **専門性を持ったエージェント構築**
  - `@backend-specialist`、`@frontend-specialist`、`@sre-specialist` など
  - 各エージェントは固有の技術スタック、ルール、ワークフローを持つ
  
- **複雑な自動化が可能**
  - Project Structure、Code Style、Git Workflow、Boundaries など詳細に定義可能
  - エージェント間のハンドオフ（タスク引き継ぎ）も可能
  
- **スケーラビリティ**
  - エージェント自身が Issue を作成し、自動フローを構築可能
  - 大規模プロジェクトの自動化に最適

#### デメリット
- **設定が複雑**
  - YAML フロントマター + マークダウン形式で、学習コストが高い
  - プロンプト最大30,000 byteの制限あり
  
- **初期の完璧さが不要だが、改善が必須**
  - 曖昧な定義や過度に複雑な設計は失敗しやすい
  - 運用しながら段階的に改善が必要
  
- **Issue の品質が重要**
  - エージェントの効果は Issue Template の整備に依存
  - 背景・要件・受け入れ条件が不足すると効果が薄れる
  
- **環境依存**
  - VS Code / GitHub.com で動作環境が分かれる
  - IDE ごとにサポート範囲が異なる

### 設定方法

#### YAML フロントマター（基本）
```markdown
---
name: test-agent
description: テストコードを作成する専門エージェントです。Jest と React Testing Library を使用します。
tools: ['read', 'search', 'edit']
---
```

#### 必須要素（優れた agents.md に必要な6つ）

1. **コマンド (Commands)**
   - 実行可能なコマンドを明記: `npm test --coverage`

2. **テスト (Testing)**
   - テストフレームワークと実行方法: Jest + React Testing Library

3. **プロジェクト構造 (Project Structure)**
   - ディレクトリ構成と役割を明記

4. **コードスタイル (Code Style)**
   - 推奨・非推奨のコード例を実装

5. **Git ワークフロー (Git Workflow)**
   - ブランチ命名規則、コミットメッセージ形式

6. **境界線 (Boundaries)**
   - Always Do / Ask First / Never Do の 3 段階で明確に定義

### 活用例
- **エージェント間での並列実装**
  - バックエンド実装と フロントエンド実装を同時進行
  
- **自動テストコード生成**
  - テストエージェントが Jest テストを自動生成
  
- **GitHub ワークフローの自動化**
  - エージェント自身が Issue / PR を作成・管理

---

## 3. Agent Skills (MCPベース)

### 概要
Model Context Protocol (MCP) を使用した外部ツール・API・データベースの統合スキル。
カスタムエージェントと組み合わせることで、高度な自動化とシステム連携が可能。

### 特徴

#### メリット
- **高度な外部連携**
  - Web API、データベース、外部ツール（Slack、Jira等）と連携可能
  - リアルタイムデータへのアクセス

- **複数スキルの組み合わせ**
  - Web検索 + データ分析 + レポート生成のような複雑フローを構築
  - スキル間の依存関係を管理可能

- **エンタープライズレベルの自動化**
  - 企業システムとの深い統合
  - カスタム業務プロセスの自動化

- **スキルの再利用性**
  - 一度構築したMCPサーバーは複数エージェントで活用可能

- **拡張性**
  - 任意のプログラミング言語でスキル実装可能

#### デメリット
- **設定が非常に複雑**
  - MCPプロトコルの理解が必須
  - Python、Node.js等でサーバー実装が必要
  - 習熟曲線が急峻（学習コスト高い）

- **開発・運用コスト高**
  - MCPサーバーの開発・テスト・デプロイが必須
  - 継続的なメンテナンスが必要
  
- **デバッグが困難**
  - MCP通信のトレースが複雑
  - エラーハンドリングが難しい
  
- **外部依存性**
  - API障害や外部ツールの非可用性に影響を受ける
  - 料金体系や利用制限の管理が必要
  - セキュリティ・認証情報の管理が重要

- **習熟曲線が急**
  - MCPプロトコルの理解が必要
  - デバッグが困難な場合がある

### 設定方法

#### MCPサーバー構成例（Python）
```python
# skills/web_search_mcp.py
from mcp import Server, Tool
from typing import Any
import requests

class WebSearchSkill:
    """Web検索スキル"""
    
    def __init__(self):
        self.server = Server("web-search")
        self.register_tools()
    
    def register_tools(self):
        @self.server.tool()
        def search_web(query: str, limit: int = 5) -> list[dict]:
            """Webを検索してリソースを取得"""
            # Google Custom Search API等を使用
            results = self.perform_search(query, limit)
            return results
        
        @self.server.tool()
        def fetch_content(url: str) -> str:
            """指定URLの内容を取得"""
            response = requests.get(url, timeout=10)
            return response.text
    
    def perform_search(self, query: str, limit: int) -> list[dict]:
        # 検索実装
        pass
```

#### agents.md での Agent Skills定義
```markdown
---
name: research-agent
description: Web調査と情報収集を行うエージェント
tools: ['web-search', 'content-fetch', 'analyze-data']
---

## スキル設定

### Web検索スキル
- Query: キーワード検索
- 上位5件を自動取得
- タイムアウト: 30秒

### コンテンツ取得スキル
- URLからHTML/JSONを抽出
- キャッシング機能あり

### データ分析スキル
- 取得データの構造化
- Markdown形式で出力
```

#### MCPサーバー利用例
```yaml
# .vscode/settings.json の MCP設定
"github.copilot.advanced": {
  "mcp": {
    "enabled": true,
    "servers": [
      {
        "name": "web-search",
        "command": "python",
        "args": ["./skills/web_search_mcp.py"]
      },
      {
        "name": "database",
        "command": "python",
        "args": ["./skills/db_mcp.py"]
      }
    ]
  }
}
```

### 活用例
- **技術調査と情報収集**
  - 最新のライブラリドキュメントをWeb検索して取得
  - 比較表を自動生成
  
- **データ分析と可視化**
  - 外部APIからデータを取得
  - 統計分析を実行、グラフを生成
  
- **自動レポート生成**
  - 複数ソースから情報を収集
  - Markdown形式のレポートを自動生成
  
- **外部ツール連携**
  - Slack、GitHub、Jiraなどとの連携
  - プロジェクト管理の自動化
  
- **システム統合自動化**
  - マイクロサービス間のデータ同期
  - クロスシステムのワークフロー構築

---

## 4. 詳細比較表

| 観点 | カスタムコマンド | カスタムエージェント | Agent Skills |
|------|-----------------|-------------------|--------------|
| **実行トリガー** | ユーザーが手動で `/` コマンド実行 | Issue アサイン / Chat 呼び出し | コマンド実行 / 自動トリガー / API |
| **並列実行** | 不可（ユーザーが順番に実行） | 可能（複数 Issue に並列アサイン） | 可能（複数スキル並列実行） |
| **設定難易度** | 低（プロンプトベース） | 高（詳細な YAML + マークダウン） | 非常に高い（MCP実装必須） |
| **自動化レベル** | 軽度（単一コマンド） | 高度（複雑なワークフロー） | 最高度（外部連携を含む複雑フロー） |
| **ハンドオフ機能** | なし | あり（エージェント間の引き継ぎ） | あり（スキル間の連携） |
| **環境** | VS Code / GitHub Chat | VS Code / GitHub.com | VS Code / GitHub.com / API |
| **MCP サーバー** | オプション | デフォルト: github, playwright | 必須（カスタムMCP対応） |
| **最大プロンプト** | 制限なし（標準的） | 30,000 bytes | 制限なし（MCPメッセージ依存） |
| **外部API連携** | 不可（コード生成のみ） | 限定的（MCP経由） | 容易（複数スキルで対応） |
| **学習難度** | 非常に低い | 中程度 | 高い |
| **デバッグ難度** | 低い（ログで追跡可能） | 中程度 | 高い（MCP通信の確認必要） |
| **保守性** | 高い（シンプル） | 中程度 | 低い（外部依存性あり） |
| **スケーラビリティ** | 低い（手動実行） | 高い（複数タスク並列化） | 非常に高い（外部リソース活用） |
| **チーム導入の容易性** | 最も容易（すぐに効果実感） | 中程度（運用経験が必要） | 困難（技術的投資が必須） |
| **必要なスキル** | マークダウン、プロンプト設計 | マークダウン、システム理解 | バックエンド開発、MCP, API設計 |
| **開発期間** | 数時間～1日 | 数日～2週間 | 2週間～3ヶ月 |
| **運用コスト** | 低い | 中程度 | 高い（外部依存管理） |

---

## 5. 使い分けのガイドライン

### カスタムコマンドを選ぶべき場合
- ✅ 定期的に繰り返す簡単なタスク（コードレビュー、ドキュメント生成）
- ✅ フォーマットやルールを統一したい
- ✅ 学習・導入コストを最小化したい
- ✅ チーム全体で共有したいテンプレート
- ✅ 外部システムとの連携が不要
- **推奨チーム規模**: 3~20名

### カスタムエージェントを選ぶべき場合
- ✅ Issue に自動アサインして並列実装したい
- ✅ 複数ステップの複雑な自動化フローが必要
- ✅ 専門分野別（フロントエンド、バックエンド等）にエージェントを分けたい
- ✅ 大規模プロジェクトで自動化の効果を最大化したい
- ✅ チーム内にエージェント運用リソースがある
- **推奨チーム規模**: 10~50名
- **推奨プロジェクト規模**: 中～大規模（複数リポジトリ）

### Agent Skillsを選ぶべき場合
- ✅ 外部API・ツール・データベースとの統合が必要
- ✅ Web検索、データ分析などの高度な機能が必須
- ✅ 専門技術ツール（Slack、Jira、Datadog等）との連携が必要
- ✅ リアルタイムデータへのアクセスが必要
- ✅ チーム内にバックエンド開発者がいる
- ✅ 外部サービスの信頼性が確保できている
- **推奨チーム規模**: 20名以上
- **推奨プロジェクト規模**: 大規模・複雑（マイクロサービス等）
- **推奨投資規模**: 高い（MCPサーバー開発・運用リソース）

---

## 6. ベストプラクティス

### カスタムコマンド
1. **シンプルに始める**
   - 1つのタスクに特化した単純なプロンプト

2. **チーム内で共有**
   - awesome-copilot リポジトリのサンプルを活用

3. **段階的に拡張**
   - 実際の使用経験をベースに改善

### カスタムエージェント
1. **最小限の定義から開始**
   - name, description, 基本的なルールのみ

2. **運用経験から改善**
   - エージェントが意図しない動作をしたら、その経験から境界線を追加

3. **Issue Template を整備**
   - エージェントの効果は Issue の品質に依存
   - 背景・要件・受け入れ条件を漏れなく記載する習慣をつける

4. **MCP サーバーの活用**
   - github（GitHub API）、playwright（ブラウザ自動化）のデフォルトツールを活用

### Agent Skills
1. **MCPサーバーの設計から始める**
   - まず利用するスキル（機能）を明確化
   - 単一責任の原則に従ったMCPサーバーを複数個持つ

2. **エラーハンドリングを厳密に**
   - 外部API呼び出しはタイムアウト・再試行ロジック必須
   - ユーザーに明確なエラーメッセージを返す

3. **セキュリティと監査を重視**
   - APIキー・認証情報の安全な管理
   - すべてのスキル利用をログに記録
   - オーガニゼーションレベルでのアクセス制御を設定

4. **段階的なロールアウト**
   - パイロットグループで検証
   - フィードバックをもとに改善
   - 本格運用時には支援体制を整備

5. **定期的なメンテナンス**
   - 外部API・ライブラリの更新確認
   - 使用頻度・効果の測定
   - コスト管理（API呼び出し数・料金）

---

## 7. 実装のポイント

### 共通ポイント：曖昧な定義は避ける
```markdown
# NG: 曖昧すぎる
あなたは親切なコーディングアシスタントです。

# OK: 具体的で明確
あなたは React コンポーネントのテストを書くテストエンジニアです。
Jest と React Testing Library を使用し、__tests__ ディレクトリにテストを配置します。
```

### 共通ポイント：過度に複雑な設計は避ける
- 最初から「何でもできるエージェント」を作ろうとしない
- 単一責任を持つ専門エージェント・スキルを複数個持つ方が効果的

### Agent Skillsに固有のポイント

#### 1. MCP通信の最小化
```python
# NG: 毎回API呼び出し
def process_data(data):
    for item in data:
        result = api_call(item)  # N回呼び出し

# OK: バッチ処理・キャッシング
def process_data(data):
    # キャッシュをチェック
    cached = check_cache(data)
    new_items = [item for item in data if item not in cached]
    
    if new_items:
        results = api_call_batch(new_items)
        update_cache(results)
    
    return cached + results
```

#### 2. スキル間の依存関係を明確化
```yaml
# skills/data_pipeline.yml
skills:
  fetch:
    depends_on: []
    inputs: [url]
    outputs: [raw_data]
  
  transform:
    depends_on: [fetch]
    inputs: [raw_data]
    outputs: [clean_data]
  
  analyze:
    depends_on: [transform]
    inputs: [clean_data]
    outputs: [insights]
```

#### 3. フェイルセーフの実装
```python
# スキルの実行結果には常に success/error フラグを含める
def skill_execute(params):
    try:
        result = perform_action(params)
        return {
            "success": True,
            "data": result,
            "error": None
        }
    except Exception as e:
        return {
            "success": False,
            "data": None,
            "error": str(e),
            "fallback": get_fallback_data(params)
        }
```

---

## 8. 参考リンク

### カスタムコマンド
- [GitHub Copilot カスタムコマンドを使ってみた](https://zenn.dev/ren21/articles/de3da1fdaf71d4)
- awesome-copilot リポジトリ（GitHub 公式）

### カスタムエージェント
- [GitHub Copilot カスタムエージェントのための agents.md 作成ベストプラクティス](https://zenn.dev/studypocket/articles/github-copilot-agents-md-best-practices)
- GitHub 公式ドキュメント（2,500+ リポジトリの分析結果）

### Agent Skills & Model Context Protocol
- [Model Context Protocol (MCP) 公式ドキュメント](https://modelcontextprotocol.io)
- [MCPスペック: Tool使用方式](https://spec.modelcontextprotocol.io/latest/basic/tools/)
- [MCPサーバー実装例（Python）](https://github.com/modelcontextprotocol/python-sdk)
- [Anthropic Claude APIドキュメント](https://docs.anthropic.com)

### 関連記事
- 「Agent Skills」の解説記事（技術ブログ）
- [GitHub Copilot Agent Skillsを活用した自動化戦略]
- [MCPプロトコルを使用したカスタムスキル開発ガイド]

---

## 9. まとめ

| 機能 | 位置付け | 適用場面 | 難易度 |
|------|---------|---------|--------|
| **カスタムコマンド** | 軽量な工具 | 繰り返しタスク、テンプレート化 | 低 |
| **カスタムエージェント** | 自動化エンジン | 並列実装、複雑ワークフロー | 中 |
| **Agent Skills** | 統合プラットフォーム | 外部連携、高度な自動化 | 高 |

### 三者の関係図
```
カスタムコマンド
├── 単純・直感的
├── 個人レベルの効率化
└── すぐに導入可能

      ↓ スケーリング

カスタムエージェント
├── 複雑・体系的
├── チームレベルの効率化
└── 運用経験が必要

      ↓ 外部連携

Agent Skills (MCPベース)
├── 最も複雑・最も強力
├── 企業レベルの自動化
└── 技術投資が必須
```

### 推奨アプローチ

**段階的な導入フロー：**

```
Phase 1: カスタムコマンド (1~3ヶ月)
  ├── 目的: Copilot活用の習慣化
  ├── 成果物: 5~10個のコマンド
  └── 効果検証: コマンド利用頻度、時間削減率

Phase 2: カスタムエージェント (3~6ヶ月)
  ├── 目的: 自動化ワークフローの構築
  ├── 成果物: 2~3個のエージェント
  └── 効果検証: Issue自動実装率、品質スコア

Phase 3: Agent Skills統合 (6~12ヶ月)
  ├── 目的: 外部システムとの連携
  ├── 成果物: カスタムMCPサーバー1~2個
  └── 効果検証: 外部連携の成功率、削減コスト
```

**重要なポイント：**

1. **小さく始める**
   - 最初はカスタムコマンドで効果を実感
   - スケーリングの必要性が明確になってからエージェント導入

2. **段階的に改善**
   - 本当に必要な機能から優先的に実装
   - フィードバックループを組み込む

3. **チームの成熟度を意識**
   - エージェント：チーム内にAI活用経験者がいることが前提
   - Agent Skills：バックエンド開発体験が必須

4. **継続的な運用**
   - エージェント・スキルの効果測定
   - 利用者からのフィードバック収集
   - 定期的なアップデートと改善

---

## 10. FAQ

### Q. カスタムコマンドとAgent Skillsの使い分けは？
**A.** カスタムコマンドは「コード生成の補助」、Agent Skillsは「外部リソースの活用」。
- Web検索が必要 → Agent Skills
- ドキュメント生成 → カスタムコマンド
- APIからデータ取得 → Agent Skills

### Q. MCPサーバーの障害時の対応は？
**A.** Agent Skillsに依存する機能には必ずフォールバック機能を実装してください。
- 外部API失敗時の代替処理
- ローカルキャッシュの活用
- ユーザーへの明確な通知

### Q. Agent Skillsの開発コストは？
**A.** MCPサーバー1個あたり50~200時間の開発・テスト・ドキュメント作成が目安。
- 単純なスキル（Web検索等）: 50時間
- 複雑なスキル（複数API連携）: 150時間以上

### Q. セキュリティはどう確保する？
**A.** 以下の対策が必須：
- API認証情報の環境変数管理
- すべてのAPI呼び出しをログ記録
- オーガニゼーション単位での権限管理
- 定期的なセキュリティ監査

### Q. カスタムコマンド → エージェント → Agent Skillsの順序で導入すべき？
**A.** はい、推奨します。理由：
- 学習カーブが段階的になる
- チーム内の習熟度を高められる
- 実際の効果を測定しながら次段階に進める
- 投資を段階的に増やしていける

### Q. 複数のAgent Skillsを組み合わせる時の注意点は？
**A.** 以下に注意：
- 依存関係を明確に
- タイムアウト設定（長すぎない）
- エラーハンドリング（1つの失敗で全体が止まらない）
- ロギング（複雑なフローのデバッグに不可欠）

---

**作成日**: 2026年1月
**最終更新**: 2026年1月
